---
import { supabase } from "../lib/supabase";

type Props = {
  originalId: string;
  coverId: string;
  slug: string;
};

const { originalId, coverId, slug } = Astro.props;

const { data: originalSong } = await supabase
  .from("songs")
  .select("id, name, artists, album_img, album_name")
  .eq("id", originalId)
  .single();

const { data: coverSong } = await supabase
  .from("songs")
  .select("id, name, artists, album_img, album_name")
  .eq("id", coverId)
  .single();
---

<div class="cover-card">
  <div class="albums">
    <div class="album" transition:name={`album-${originalSong?.id}`}>
      {
        originalSong?.album_img && (
          <img
            src={originalSong.album_img[0]}
            alt={`${originalSong.album_name} album art`}
          />
        )
      }
    </div>
    <div class="album" transition:name={`album-${coverSong?.id}`}>
      {
        coverSong?.album_img && (
          <img
            src={coverSong.album_img[0]}
            alt={`${coverSong.album_name} album art`}
          />
        )
      }
    </div>
  </div>
  <div class="content">
    <h2 class="title">
      {originalSong?.name}
    </h2>
    <div class="artist">
      <strong>{coverSong?.artists[0]}</strong> covering <strong
        >{originalSong?.artists[0]}</strong
      >
    </div>
    <a
      class="link"
      href={`/cover/${slug}`}
      aria-label={`More about ${originalSong?.name}`}></a>
  </div>
</div>

<style lang="scss">
  .cover-card {
    position: relative;
    border-radius: var(--radius-m);
    display: flex;
    flex-direction: column;
    align-items: center;
    align-self: flex-start;
    gap: var(--space-xl);
    text-align: center;

    &:hover {
      .album {
        transform: rotate(0) translateX(0);
      }

      .title {
        background: linear-gradient(to right, var(--violet-9), var(--red-9));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
    }
  }

  .albums {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-m);
  }

  .album {
    background-color: var(--mauve-3);
    border-radius: var(--radius-s);
    overflow: hidden;
    aspect-ratio: 1;
    transition: transform 0.2s ease-in-out;
    // https://shadows.brumm.af/
    box-shadow:
      0px 1.7px 2.2px rgba(0, 0, 0, 0.02),
      0px 4px 5.3px rgba(0, 0, 0, 0.028),
      0px 7.5px 10px rgba(0, 0, 0, 0.035),
      0px 13.4px 17.9px rgba(0, 0, 0, 0.042),
      0px 25.1px 33.4px rgba(0, 0, 0, 0.05),
      0px 60px 80px rgba(0, 0, 0, 0.07);

    img {
      width: 100%;
    }

    &:first-child {
      width: 40%;
      transform: rotate(-10deg) translateX(10%);
      transform-origin: 100% 0;
    }

    &:last-child {
      width: 60%;
      transform: rotate(6deg) translateX(-10%);
      transform-origin: 0 0;
    }
  }

  .content {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .title,
  .artist {
    text-wrap: balance;
    transition: color 0.2s ease;
  }

  .title {
    font-size: var(--step-2);
  }

  .artist {
    color: var(--mauve-9);
  }

  .link {
    position: absolute;
    inset: 0;
  }
</style>
